# ğŸ’³ Payment Service

ì´ ì„œë¹„ìŠ¤ëŠ” **Toss Payments ì—°ë™**ì„ í†µí•´ ê²°ì œ ìš”ì²­ ë° ê²°ì œ ì·¨ì†Œë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.  
Gatewayë¥¼ í†µí•´ `/payment/**` ë˜ëŠ” `/toss/**` ê²½ë¡œë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì£¼ë¬¸ ìƒì„± ì´í›„ ê²°ì œ ìŠ¹ì¸ ë° ì·¨ì†Œ ë¡œì§ì— í™œìš©ë©ë‹ˆë‹¤.

---

## ğŸ”§ ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥            | ì„¤ëª…                                           |
|-----------------|------------------------------------------------|
| ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬   | Toss ê²°ì œ ì„±ê³µ ì½œë°±ì„ ë°›ì•„ ê²°ì œ í™•ì • ë° DB ì €ì¥ |
| ê²°ì œ ì·¨ì†Œ ì²˜ë¦¬   | ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ Toss ê²°ì œ ì·¨ì†Œ ë° DB ìƒíƒœ ì—…ë°ì´íŠ¸ |

---

## ğŸ”Œ API ëª©ë¡

### 1. ê²°ì œ ì„±ê³µ ì²˜ë¦¬

- **URL**: `GET /success`
- **ìš”ì²­ íŒŒë¼ë¯¸í„°**:
    - `paymentKey`: Tossì—ì„œ ë°˜í™˜ëœ ê²°ì œ í‚¤
    - `orderId`: ì£¼ë¬¸ ë²ˆí˜¸ (e.g. `order-xxx`)
    - `amount`: ê²°ì œ ê¸ˆì•¡

- **ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "data": {
    "orderId": "order-abc123",
    "paymentKey": "tviva20250531120311Ynvg0",
    "totalAmount": 10000,
    ...
  },
  "message": null
}
```

---

### 2. ê²°ì œ ì·¨ì†Œ ì²˜ë¦¬

- **URL**: `POST /toss/cancel`
- **ìš”ì²­ ë°”ë””**:
```json
{
  "paymentKey": "tviva20250531120311Ynvg0",
  "cancelReason": "ì‚¬ìš©ì ìš”ì²­"
}
```

- **ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "data": {
    "paymentKey": "tviva20250531120311Ynvg0",
    "orderId": "order-abc123",
    "status": "CANCELED",
    ...
  },
  "message": null
}
```

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

- Spring Boot 3.x
- WebClient (Toss API ì—°ë™)
- Spring Data JPA
- MySQL / MariaDB
- Lombok
- Spring Cloud Gateway ì—°ë™ ê°€ëŠ¥

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ í™˜ê²½

- Toss Payments í…ŒìŠ¤íŠ¸ í‚¤ ì‚¬ìš© (`test_ck_...`)
- Gateway ë° Eureka ë“±ë¡ í•„ìˆ˜ (`lb://payment-service` ì‚¬ìš©)
- HTML í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì‚¬ìš© ê°€ëŠ¥ (`test.html`ì—ì„œ `orderId` ì§ì ‘ ì§€ì •)

---

## ğŸ’¡ ê¸°íƒ€ ì°¸ê³ 

- ì£¼ë¬¸ ìƒíƒœ ì—°ë™ì€ ì¶”í›„ `order-service`ì™€ ì—°ë™ ì˜ˆì •ì…ë‹ˆë‹¤
- ë™ì¼í•œ `orderId`ë¡œ ì¤‘ë³µ ê²°ì œ ìš”ì²­ ì‹œ ì˜¤ë¥˜ ë°œìƒ â†’ í…ŒìŠ¤íŠ¸ ì‹œ `orderId` ë§¤ë²ˆ ìƒˆë¡œ ìƒì„± í•„ìš”
- ì·¨ì†Œ ì‹œ `pgTransactionId` ê¸°ì¤€ìœ¼ë¡œ DB ìƒíƒœë„ `FAILED`ë¡œ ìë™ ë³€ê²½ë©ë‹ˆë‹¤